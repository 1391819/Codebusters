{%extends "layout.html"%}
{% block content%}
<div class="wrapper-booking">
    <div class="booking-content">
        <form methods="POST" action="{{url_for('booking')}}">
            <div class="form-group">
                <label for="{{ form.movie_id}}"> Movie: </label>
                    {{ form.movie_id(class = "form-control")}}
            <br>
                <label for="{{ form.screening_time }}">Screening Time:</label>
                {{ form.screening_time(class="form-control") }}
            <br>
                <label for="{{ form.booker_name}}"> Booker's name: </label>
                    {{ form.booker_name(class = "form-control")}}
            <br>

            <label for="{{ form.adult_tickets }}"> Number of Adult Tickets: </label>
                {{ form.adult_tickets(class="form-control")}}

            <br>

            <label for="{{ form.child_tickets }}"> Number of Child Tickets: </label>
                {{ form.child_tickets(class="form-control")}}

            <br>
                <label for="{{ form.concession}}"> Concession: </label>
                    {{ form.ticket_type(class = "form-check-input")}}
            <br>
                    {{ form.submit(class="w-100 btn btn-primary btn-lg custom-button")|safe }}
            </div>
        </form>
    </div>
</div>

<script>
    // Get references to the movie and screening time select fields
    const movieSelect = document.getElementById("movie_id");
    const screeningTimeSelect = document.getElementById("screening_time");

    // Define an event listener to update the screening time choices when the movie is selected
    movieSelect.addEventListener("change", () => {
        const selectedMovieId = movieSelect.value;
        // Make an AJAX request to fetch the screening times for the selected movie
        fetch(`/get_screening_times?movie_id=${selectedMovieId}`)
            .then((response) => response.json())
            .then((data) => {
                // Clear the current options
                screeningTimeSelect.innerHTML = "";
                // Populate the screening time options based on the retrieved data
                data.forEach((option) => {
                    const newOption = document.createElement("option");
                    newOption.value = option[0];
                    newOption.textContent = option[1];
                    screeningTimeSelect.appendChild(newOption);
                });
            });
    });
</script>
{%endblock%}